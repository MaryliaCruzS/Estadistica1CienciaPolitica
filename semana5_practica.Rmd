---
title: "Semana 5 - Pr치ctica Dirigida"
output: html_document
---

# Pr치ctica Dirigida 4

<center><img src=" " width="200"/></center>

**FACULTAD DE CIENCIAS SOCIALES - PUCP**<br>

## Curso: POL 278 - Estad칤stica para el an치lisis pol칤tico 1 \| Semestre 2025 - 1 <br>

------------------------------------------------------------------------

# **Din치micas del uso de los medios de transporte en Lima**

El crecimiento acelerado de Lima ha generado una creciente preocupaci칩n sobre la calidad y eficiencia de los medios de transporte en la ciudad. La congesti칩n vehicular, la falta de infraestructura adecuada y los largos tiempos de viaje afectan diariamente a millones de lime침os. En este contexto, el an치lisis de datos cuantitativos se vuelve indispensable para entender el comportamiento de los usuarios, identificar 치reas cr칤ticas y dise침ar soluciones efectivas. En ese sentido en esta sesi칩n responderemos a la siguiente pregunta:


## 쮺u치l es el estado del transporte en Lima seg칰n sus residentes? 游뱂


Para acercarnos a responder la pregunta antes planteada se busc칩 informaci칩n relacionada al uso del transporte p칰blico en Lima. Por lo tanto se eligi칩 la encuesta de Lima Como Vamos, la cual es realizada a ciudadanos de Lima y Callao con la finalidad de conocer su percepci칩n acerca de la movilidad, ambiente, seguridad ciudadana, espacios de recreaci칩n, cultura y satisfacci칩n con la ciudad. Pueden encontrar m치s informaci칩n acerca de esta base [aqu칤](https://www.limacomovamos.org/data/).

Para esta sesi칩n se usar치 una versi칩n *subseteada* de a침os anteriores que contiene las siguientes variables:

![](pd4_diccionario.PNG) 


```{r}
library(rio)
data=import("pd4_Limacomovamos.xlsx") 
```

## 쮺u치l es el intervalo de confianza para la proporci칩n de las personas que est치n satisfechas con el transporte p칰blico en Lima?


Para ello trabajaremos con la variable satis_transporte, que tiene dos valores posibles: Satisfecho y no satisfecho.

Para poder encontrar el intervalo de confianza para la proporci칩n de ciudadanos de Lima y Callao satisfechos con el sistema de transporte, necesitamos tener muy claro la frecuencia de nuestro caso de 칠xito y del total de casos.

```{r}
table(data$satis_transporte)
```

```{r}
sum(table(data$satis_transporte))
```
Hallamos el invervalo de confianza para una proporci칩n con el comando

```{r}
test_result <- prop.test(194, 3738, conf.level = 0.95)
test_result
```
Pasos para graficar: Intervalo de Confianza de una proporci칩n

```{r}
# Extraer los resultados
proporcion <- test_result$estimate
lower_ci <- test_result$conf.int[1]
upper_ci <- test_result$conf.int[2]
```


```{r}
# Crear un data frame para ggplot
datita <- data.frame(
  Categoria = "Proporci칩n",
  Proporci칩n = proporcion,
  Lower_CI = lower_ci,
  Upper_CI = upper_ci
)
```

Gr치fico del Intervalo de Confianza de una proporci칩n

```{r}
# Graficar
library(ggplot2)
ggplot(datita, aes(x = Categoria, y = Proporci칩n)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  geom_errorbar(aes(ymin = Lower_CI, ymax = Upper_CI), width = 0.2, color = "darkblue") +
  labs(title = "Intervalo de Confianza para Proporci칩n",
       y = "Proporci칩n",
       x = "") +
  theme_minimal()
```

Esto quiere decir que tenemos un 95% de certeza de que, en la poblaci칩n, el porcentaje de ciudadanos de Lima y Callao satisfechos con el sistema de transporte oscila entre el 4.5% y 5.9% .


## 쮺u치nto gastan los residentes de Lima en transporte?

*Hallemos el intervalo de confianza para la media de la variable "PE10A".*

El enunciado de la pregunta es indicar "En promedio, 쯖u치nto gasta su hogar en Transporte?".

```{r}
class(data$PE10A) #Revisemos que nuestra variable est칠 bien clasificada
```

**ciMean**, del paquete **lsr**, es la funci칩n que calcula el intervalo de confianza de una media.

```{r}
library(lsr)
ic_media = ciMean(data$PE10A, na.rm = TRUE) #con el 칰ltimo argumento indicamos no tomar en consideracion los valores perdidos (NA)

ic_media
```

```{r}
library(dplyr)
ic_grupo = data %>%
  summarise(Media = mean(PE10A, na.rm=T),
            LimiteInferior = ciMean(PE10A, na.rm=T)[1],
            LimiteSuperior = ciMean(PE10A, na.rm=T)[2])
ic_grupo
```


## 쮻e qu칠 manera la zona de Lima en la que vive la persona se relaciona con su gasto en transporte?

Hallemos el intervalo de confianza para el gasto en trasporte en promedio (PE10A) seg칰n estrato de lima (ESTRATOS_IOP).

Agreguemos etiquetas a la categ칩rica

![](pd4_estratos.png)

```{r}
data = data %>% 
  mutate(ESTRATOS_IOP=factor(ESTRATOS_IOP, levels = (1:4), labels = c("Lima Centro","Lima Este","Lima Norte", "Lima Sur")))
```

Crearemos una tabla con la media, m치ximo y m칤nimo de la variable PE10A, en base al grupo de ESTRATOS_IOP.

```{r}
library(dplyr)
ic_grupo = data %>%
  group_by(ESTRATOS_IOP)%>%summarise(Media = mean(PE10A, na.rm=T),
            LimiteInferior = ciMean(PE10A, na.rm=T)[1],
            LimiteSuperior = ciMean(PE10A, na.rm=T)[2])
ic_grupo
```

Seg칰n nuestra tabla, podemos afirmar que hay un 95% de probabilidad de que a nivel poblacional la media del grupo que los residentes de Lima Centro y Lima Norte gastan m치s en transporte que los de Lima Este.

Grafiquemos nuestros resultados.

```{r}
library(ggplot2)

ggplot(ic_grupo, aes(x = ESTRATOS_IOP, y = Media)) +
  geom_bar(stat = "identity", fill = "#00688B", color = "black") +
  geom_errorbar(aes(ymin = LimiteInferior, ymax = LimiteSuperior), width = 0.2) +
  
  # Etiquetas de la media
  geom_text(aes(label = paste(round(Media, 2))), vjust = -1, size = 4) +
  
  # Etiquetas de los valores m칤nimos
  geom_text(aes(y = LimiteInferior, label = paste("min:", round(LimiteInferior, 2))), 
            vjust = 1.5, hjust = -0.2, size = 3, color = "white") +
  
  # Etiquetas de los valores m치ximos
  geom_text(aes(y = LimiteSuperior, label = paste("max:", round(LimiteSuperior, 2))), 
            vjust = -0.5, hjust = -0.2, size = 3, color = "#00688B") +
  
  xlab("Zona de Lima") + 
  ylab("Promedio del gasto en transporte") +
  ylim(0, 140) +
  theme_minimal()
```

Con lo que muestra el gr치fico, 쯖칩mo podemos complementar nuestra interpretaci칩n anterior?

- Lima Centro gasta significativamente m치s que Lima Este y Lima Sur, como lo indican los promedios y la falta de superposici칩n considerable entre los IC.
- Lima Norte presenta un rango de gasto m치s amplio, lo que sugiere una variabilidad mayor en el gasto de transporte dentro de esa zona.
- Lima Este tiene un gasto m치s bajo y su intervalo de confianza no se superpone con el de Lima Centro, lo que podr칤a indicar diferencias estad칤sticamente significativas entre estas dos zonas.

## 쮼xiste una diferencia estad칤sticamente significativa entre el gasto en transporte entre hombres y mujeres?

Reviso mi df
```{r}
str(data)
```

```{r}
GSexo = data %>% 
  group_by(SEXO) %>%
  summarize(Media = mean(PE10A, na.rm = T))
GSexo
```

```{r}
GSexo[1,2] - GSexo[2,2]
```

La diferencia es de aprox 11 soles. 쯇uedo afirmar que existe esta diferencia en la poblaci칩n?

Para poder evaluar si existen o no diferencias poblacionales usaremos t.test

```{r}
t.test(PE10A ~ SEXO, data = data)
```

El valor p- value es 0.2642, que es mayor que el nivel t칤pico de significancia (generalmente 풤 = 0.05). Un valor p alto sugiere que *no* hay suficiente evidencia para rechazar la hip칩tesis nula. En otras palabras, no podemos concluir que existe una diferencia significativa entre las medias de los dos grupos (hombres y mujeres) con respecto a la variable PE10A.

# **Ejercicios para casa**

1.  Calcular el intervalo de confianza de la media para los a침os que llevan viviendo en Lima/Callao los residentes de Lima/Callao (EG2OTRO). Interprete
2.  Muestra un gr치fico que los intervalos de confianza para la media de EG2OTRO seg칰n nivel socio econ칩mico (NSE_IOP). Interprete
3.  A partir de la variable EG2OTRO, se cre칩 "A침oslima". Que tiene dos grupos "M치s de 50 a침os" o "De 50 a침os a menos". Calcula el intervalo de confianza para la proporci칩n de la variable "A침oslima" e interpreta.
